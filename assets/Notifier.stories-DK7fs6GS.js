import{bR as I,j as S,aB as W,bS as F}from"./index-D3QtTYcx.js";import{M as $,A as C}from"./constants-VGTGrGmu.js";import{g as J}from"./generateStoryDecorator-DsoMrMh3.js";import"./index-CBqU2yxZ.js";import"./_baseClone-CBkhujLI.js";import"./isPlainObject-Dl0da9pc.js";import"./_commonjsHelpers-BosuxZz1.js";import"./mapValues-CZXAhdHD.js";import"./index-Ch9hqOxJ.js";import"./toNumber-BGTiNFDU.js";import"./StoryBox-DeLdszCZ.js";import"./fr_FR-BAq5VERt.js";class V extends CustomEvent{constructor(t,e,n=!1){super("NOTIFICATION_EVENT",{detail:{isSideWindowError:n,message:t,type:e}})}}const K=Object.prototype.toString;function X(s,t){return K.call(s)===`[object ${t}]`}function U(s){return X(s,"Object")}function P(s){return!!(s&&s.then&&typeof s.then=="function")}function m(s){return s&&s.Math==Math?s:void 0}const u=typeof globalThis=="object"&&m(globalThis)||typeof window=="object"&&m(window)||typeof self=="object"&&m(self)||typeof global=="object"&&m(global)||function(){return this}()||{};function Q(){return u}function D(s,t,e){const n=e||u,i=n.__SENTRY__=n.__SENTRY__||{};return i[s]||(i[s]=t())}const Z="Sentry Logger ",N=["debug","info","warn","error","log","assert","trace"];function M(s){if(!("console"in u))return s();const t=u.console,e={};N.forEach(n=>{const i=t[n]&&t[n].__sentry_original__;n in t&&i&&(e[n]=t[n],t[n]=i)});try{return s()}finally{Object.keys(e).forEach(n=>{t[n]=e[n]})}}function O(){let s=!1;const t={enable:()=>{s=!0},disable:()=>{s=!1}};return typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?N.forEach(e=>{t[e]=(...n)=>{s&&M(()=>{u.console[e](`${Z}[${e}]:`,...n)})}}):N.forEach(e=>{t[e]=()=>{}}),t}let p;typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?p=D("logger",O):p=O();function z(s){return T(s,new Map)}function T(s,t){if(U(s)){const e=t.get(s);if(e!==void 0)return e;const n={};t.set(s,n);for(const i of Object.keys(s))typeof s[i]<"u"&&(n[i]=T(s[i],t));return n}if(Array.isArray(s)){const e=t.get(s);if(e!==void 0)return e;const n=[];return t.set(s,n),s.forEach(i=>{n.push(T(i,t))}),n}return s}function g(){const s=u,t=s.crypto||s.msCrypto;if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");const e=t&&t.getRandomValues?()=>t.getRandomValues(new Uint8Array(1))[0]:()=>Math.random()*16;return("10000000100040008000"+1e11).replace(/[018]/g,n=>(n^(e()&15)>>n/4).toString(16))}function tt(s){return Array.isArray(s)?s:[s]}function et(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function st(){return!et()&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"}function nt(s,t){return s.require(t)}var d;(function(s){s[s.PENDING=0]="PENDING";const e=1;s[s.RESOLVED=e]="RESOLVED";const n=2;s[s.REJECTED=n]="REJECTED"})(d||(d={}));class c{__init(){this._state=d.PENDING}__init2(){this._handlers=[]}constructor(t){c.prototype.__init.call(this),c.prototype.__init2.call(this),c.prototype.__init3.call(this),c.prototype.__init4.call(this),c.prototype.__init5.call(this),c.prototype.__init6.call(this);try{t(this._resolve,this._reject)}catch(e){this._reject(e)}}then(t,e){return new c((n,i)=>{this._handlers.push([!1,r=>{if(!t)n(r);else try{n(t(r))}catch(o){i(o)}},r=>{if(!e)i(r);else try{n(e(r))}catch(o){i(o)}}]),this._executeHandlers()})}catch(t){return this.then(e=>e,t)}finally(t){return new c((e,n)=>{let i,r;return this.then(o=>{r=!1,i=o,t&&t()},o=>{r=!0,i=o,t&&t()}).then(()=>{if(r){n(i);return}e(i)})})}__init3(){this._resolve=t=>{this._setResult(d.RESOLVED,t)}}__init4(){this._reject=t=>{this._setResult(d.REJECTED,t)}}__init5(){this._setResult=(t,e)=>{if(this._state===d.PENDING){if(P(e)){e.then(this._resolve,this._reject);return}this._state=t,this._value=e,this._executeHandlers()}}}__init6(){this._executeHandlers=()=>{if(this._state===d.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach(e=>{e[0]||(this._state===d.RESOLVED&&e[1](this._value),this._state===d.REJECTED&&e[2](this._value),e[0]=!0)})}}}const Y=Q(),R={nowSeconds:()=>Date.now()/1e3};function it(){const{performance:s}=Y;if(!s||!s.now)return;const t=Date.now()-s.now();return{now:()=>s.now(),timeOrigin:t}}function rt(){try{return nt(module,"perf_hooks").performance}catch{return}}const y=st()?rt():it(),L=y===void 0?R:{nowSeconds:()=>(y.timeOrigin+y.now())/1e3},j=R.nowSeconds.bind(R),G=L.nowSeconds.bind(L);(()=>{const{performance:s}=Y;if(!s||!s.now)return;const t=3600*1e3,e=s.now(),n=Date.now(),i=s.timeOrigin?Math.abs(s.timeOrigin+e-n):t,r=i<t,o=s.timing&&s.timing.navigationStart,a=typeof o=="number"?Math.abs(o+e-n):t,h=a<t;return r||h?i<=a?s.timeOrigin:o:n})();const ot="production";function at(s){const t=G(),e={sid:g(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>ct(e)};return s&&E(e,s),e}function E(s,t={}){if(t.user&&(!s.ipAddress&&t.user.ip_address&&(s.ipAddress=t.user.ip_address),!s.did&&!t.did&&(s.did=t.user.id||t.user.email||t.user.username)),s.timestamp=t.timestamp||G(),t.ignoreDuration&&(s.ignoreDuration=t.ignoreDuration),t.sid&&(s.sid=t.sid.length===32?t.sid:g()),t.init!==void 0&&(s.init=t.init),!s.did&&t.did&&(s.did=`${t.did}`),typeof t.started=="number"&&(s.started=t.started),s.ignoreDuration)s.duration=void 0;else if(typeof t.duration=="number")s.duration=t.duration;else{const e=s.timestamp-s.started;s.duration=e>=0?e:0}t.release&&(s.release=t.release),t.environment&&(s.environment=t.environment),!s.ipAddress&&t.ipAddress&&(s.ipAddress=t.ipAddress),!s.userAgent&&t.userAgent&&(s.userAgent=t.userAgent),typeof t.errors=="number"&&(s.errors=t.errors),t.status&&(s.status=t.status)}function _t(s,t){let e={};t?e={status:t}:s.status==="ok"&&(e={status:"exited"}),E(s,e)}function ct(s){return z({sid:`${s.sid}`,init:s.init,started:new Date(s.started*1e3).toISOString(),timestamp:new Date(s.timestamp*1e3).toISOString(),status:s.status,errors:s.errors,did:typeof s.did=="number"||typeof s.did=="string"?`${s.did}`:void 0,duration:s.duration,attrs:{release:s.release,environment:s.environment,ip_address:s.ipAddress,user_agent:s.userAgent}})}const ut=100;class f{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}static clone(t){const e=new f;return t&&(e._breadcrumbs=[...t._breadcrumbs],e._tags={...t._tags},e._extra={...t._extra},e._contexts={...t._contexts},e._user=t._user,e._level=t._level,e._span=t._span,e._session=t._session,e._transactionName=t._transactionName,e._fingerprint=t._fingerprint,e._eventProcessors=[...t._eventProcessors],e._requestSession=t._requestSession,e._attachments=[...t._attachments],e._sdkProcessingMetadata={...t._sdkProcessingMetadata}),e}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{},this._session&&E(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,e){return this._tags={...this._tags,[t]:e},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,e){return this._extra={...this._extra,[t]:e},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,e){return e===null?delete this._contexts[t]:this._contexts[t]=e,this._notifyScopeListeners(),this}setSpan(t){return this._span=t,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const t=this.getSpan();return t&&t.transaction}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;if(typeof t=="function"){const e=t(this);return e instanceof f?e:this}return t instanceof f?(this._tags={...this._tags,...t._tags},this._extra={...this._extra,...t._extra},this._contexts={...this._contexts,...t._contexts},t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession)):U(t)&&(t=t,this._tags={...this._tags,...t.tags},this._extra={...this._extra,...t.extra},this._contexts={...this._contexts,...t.contexts},t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this}addBreadcrumb(t,e){const n=typeof e=="number"?e:ut;if(n<=0)return this;const i={timestamp:j(),...t};return this._breadcrumbs=[...this._breadcrumbs,i].slice(-n),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}getAttachments(){return this._attachments}clearAttachments(){return this._attachments=[],this}applyToEvent(t,e={}){if(this._extra&&Object.keys(this._extra).length&&(t.extra={...this._extra,...t.extra}),this._tags&&Object.keys(this._tags).length&&(t.tags={...this._tags,...t.tags}),this._user&&Object.keys(this._user).length&&(t.user={...this._user,...t.user}),this._contexts&&Object.keys(this._contexts).length&&(t.contexts={...this._contexts,...t.contexts}),this._level&&(t.level=this._level),this._transactionName&&(t.transaction=this._transactionName),this._span){t.contexts={trace:this._span.getTraceContext(),...t.contexts};const n=this._span.transaction;if(n){t.sdkProcessingMetadata={dynamicSamplingContext:n.getDynamicSamplingContext(),...t.sdkProcessingMetadata};const i=n.name;i&&(t.tags={transaction:i,...t.tags})}}return this._applyFingerprint(t),t.breadcrumbs=[...t.breadcrumbs||[],...this._breadcrumbs],t.breadcrumbs=t.breadcrumbs.length>0?t.breadcrumbs:void 0,t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...this._sdkProcessingMetadata},this._notifyEventProcessors([...dt(),...this._eventProcessors],t,e)}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...t},this}_notifyEventProcessors(t,e,n,i=0){return new c((r,o)=>{const _=t[i];if(e===null||typeof _!="function")r(e);else{const a=_({...e},n);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.id&&a===null&&p.log(`Event processor "${_.id}" dropped event`),P(a)?a.then(h=>this._notifyEventProcessors(t,h,n,i+1).then(r)).then(null,o):this._notifyEventProcessors(t,a,n,i+1).then(r).then(null,o)}})}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}_applyFingerprint(t){t.fingerprint=t.fingerprint?tt(t.fingerprint):[],this._fingerprint&&(t.fingerprint=t.fingerprint.concat(this._fingerprint)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}}function dt(){return D("globalEventProcessors",()=>[])}const H=4,ht=100;class x{constructor(t,e=new f,n=H){this._version=n,this._stack=[{scope:e}],t&&this.bindClient(t)}isOlderThan(t){return this._version<t}bindClient(t){const e=this.getStackTop();e.client=t,t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=f.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(t){const e=this.pushScope();try{t(e)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(t,e){const n=this._lastEventId=e&&e.event_id?e.event_id:g(),i=new Error("Sentry syntheticException");return this._withClient((r,o)=>{r.captureException(t,{originalException:t,syntheticException:i,...e,event_id:n},o)}),n}captureMessage(t,e,n){const i=this._lastEventId=n&&n.event_id?n.event_id:g(),r=new Error(t);return this._withClient((o,_)=>{o.captureMessage(t,e,{originalException:t,syntheticException:r,...n,event_id:i},_)}),i}captureEvent(t,e){const n=e&&e.event_id?e.event_id:g();return t.type||(this._lastEventId=n),this._withClient((i,r)=>{i.captureEvent(t,{...e,event_id:n},r)}),n}lastEventId(){return this._lastEventId}addBreadcrumb(t,e){const{scope:n,client:i}=this.getStackTop();if(!i)return;const{beforeBreadcrumb:r=null,maxBreadcrumbs:o=ht}=i.getOptions&&i.getOptions()||{};if(o<=0)return;const a={timestamp:j(),...t},h=r?M(()=>r(a,e)):a;h!==null&&(i.emit&&i.emit("beforeAddBreadcrumb",h,e),n.addBreadcrumb(h,o))}setUser(t){this.getScope().setUser(t)}setTags(t){this.getScope().setTags(t)}setExtras(t){this.getScope().setExtras(t)}setTag(t,e){this.getScope().setTag(t,e)}setExtra(t,e){this.getScope().setExtra(t,e)}setContext(t,e){this.getScope().setContext(t,e)}configureScope(t){const{scope:e,client:n}=this.getStackTop();n&&t(e)}run(t){const e=B(this);try{t(this)}finally{B(e)}}getIntegration(t){const e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&p.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,e){const n=this._callExtensionMethod("startTransaction",t,e);return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&!n&&console.warn(`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':
Sentry.addTracingExtensions();
Sentry.init({...});
`),n}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this._sendSessionUpdate()}endSession(){const e=this.getStackTop().scope,n=e.getSession();n&&_t(n),this._sendSessionUpdate(),e.setSession()}startSession(t){const{scope:e,client:n}=this.getStackTop(),{release:i,environment:r=ot}=n&&n.getOptions()||{},{userAgent:o}=u.navigator||{},_=at({release:i,environment:r,user:e.getUser(),...o&&{userAgent:o},...t}),a=e.getSession&&e.getSession();return a&&a.status==="ok"&&E(a,{status:"exited"}),this.endSession(),e.setSession(_),_}shouldSendDefaultPii(){const t=this.getClient(),e=t&&t.getOptions();return!!(e&&e.sendDefaultPii)}_sendSessionUpdate(){const{scope:t,client:e}=this.getStackTop(),n=t.getSession();n&&e&&e.captureSession&&e.captureSession(n)}_withClient(t){const{scope:e,client:n}=this.getStackTop();n&&t(n,e)}_callExtensionMethod(t,...e){const i=b().__SENTRY__;if(i&&i.extensions&&typeof i.extensions[t]=="function")return i.extensions[t].apply(this,e);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&p.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function b(){return u.__SENTRY__=u.__SENTRY__||{extensions:{},hub:void 0},u}function B(s){const t=b(),e=w(t);return q(t,s),e}function ft(){const s=b();if(s.__SENTRY__&&s.__SENTRY__.acs){const t=s.__SENTRY__.acs.getCurrentHub();if(t)return t}return lt(s)}function lt(s=b()){return(!gt(s)||w(s).isOlderThan(H))&&q(s,new x),w(s)}function gt(s){return!!(s&&s.__SENTRY__&&s.__SENTRY__.hub)}function w(s){return D("hub",()=>new x,s)}function q(s,t){if(!s)return!1;const e=s.__SENTRY__=s.__SENTRY__||{};return e.hub=t,!0}function pt(s,t){const e=typeof t=="string"?t:void 0,n=typeof t!="string"?{captureContext:t}:void 0;return ft().captureMessage(s,e,n)}function St({context:s={},isSideWindowError:t=!1,message:e,originalError:n,userMessage:i}){console.group(`Soft Error: ${e}`),console.debug("context",s),console.debug("originalError",n),console.groupEnd();const r=n?{...s,originalError:n}:{...s};pt(e,{extra:r,level:"warning"}),i&&window.document.dispatchEvent(new V(i,"error",t))}const kt={...$,title:"Components/Notifier",component:I,argTypes:{isSideWindow:C.OPTIONAL_BOOLEAN},args:{isSideWindow:!1},decorators:[J({withBackgroundButton:!0,withNewWindowButton:!0})]};function l(s){const t=()=>{St({isSideWindowError:!!s.isSideWindow,message:"An error message",userMessage:`Une erreur est survenue à ${F().format("HH[h]mm[m]ss[s et ]SSS[ms]")}.`})};return S.jsxs(S.Fragment,{children:[S.jsx(I,{...s}),S.jsx(W,{onClick:t,children:"Log a soft error"})]})}l.__docgenInfo={description:"",methods:[],displayName:"_Notifier",props:{isSideWindow:{required:!1,tsType:{name:"union",raw:"boolean | undefined",elements:[{name:"boolean"},{name:"undefined"}]},description:""}}};var k,v,A;l.parameters={...l.parameters,docs:{...(k=l.parameters)==null?void 0:k.docs,source:{originalSource:`function _Notifier(props: NotifierProps) {
  const log = () => {
    logSoftError({
      isSideWindowError: !!props.isSideWindow,
      message: 'An error message',
      userMessage: \`Une erreur est survenue à \${dayjs().format('HH[h]mm[m]ss[s et ]SSS[ms]')}.\`
    });
  };
  return <>
      <Notifier {...props} />

      <Button onClick={log}>Log a soft error</Button>
    </>;
}`,...(A=(v=l.parameters)==null?void 0:v.docs)==null?void 0:A.source}}};const vt=["_Notifier"];export{l as _Notifier,vt as __namedExportsOrder,kt as default};
