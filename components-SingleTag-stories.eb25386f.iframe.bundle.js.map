{"version":3,"file":"components-SingleTag-stories.eb25386f.iframe.bundle.js","mappings":";;;;AA0HA;;;;AAKA","sources":["webpack://@mtes-mct/monitor-ui__root/./.storybook/components/StoryDecorator.tsx"],"sourcesContent":["import { forwardRef, useEffect, useImperativeHandle, useMemo, useState, useRef } from 'react'\nimport styled from 'styled-components'\n\nimport { GlobalDecoratorWrapper } from './GlobalDecorator'\nimport { Accent, Button, NewWindow, Size, THEME, useForceUpdate, useNewWindow, NewWindowContext } from '../../src'\n\nimport type { NewWindowContextValue } from '../../src'\nimport type { Story, StoryContext } from '@storybook/react'\nimport type { ForwardedRef, MutableRefObject } from 'react'\n\nexport function generateStoryDecorator({\n  fixedWidth,\n  hasDarkMode = false,\n  withNewWindowButton = false\n}: {\n  fixedWidth?: number\n  hasDarkMode?: boolean\n  withNewWindowButton?: boolean\n} = {}) {\n  return function StoryDecorator(Story: Story, { args }: StoryContext) {\n    const newWindowRef = useRef() as MutableRefObject<HTMLDivElement>\n\n    const [isNewWindowOpen, setIsNewWindowOpen] = useState(false)\n\n    const style = useMemo(\n      () => ({\n        ...(fixedWidth\n          ? {\n              width: `${fixedWidth}px`\n            }\n          : {}),\n        ...(hasDarkMode\n          ? {\n              backgroundColor: args.isLight ? THEME.color.gainsboro : THEME.color.white\n            }\n          : {})\n      }),\n      [args.isLight]\n    )\n\n    const { forceUpdate } = useForceUpdate()\n\n    useEffect(() => {\n      forceUpdate()\n    }, [forceUpdate])\n\n    return (\n      <>\n        {withNewWindowButton && (\n          <NewWindowButtonBox>\n            <Button accent={Accent.SECONDARY} onClick={() => setIsNewWindowOpen(true)} size={Size.SMALL}>\n              OPEN IN NEW WINDOW\n            </Button>\n          </NewWindowButtonBox>\n        )}\n\n        {!isNewWindowOpen && (\n          <StoryBox style={style}>\n            <Story />\n          </StoryBox>\n        )}\n\n        {withNewWindowButton && isNewWindowOpen && (\n          <NewWindow features={{ height: 600, width: 800 }} onUnload={() => setIsNewWindowOpen(false)}>\n            <NewWindowStoryWrapper ref={newWindowRef} Story={Story} />\n          </NewWindow>\n        )}\n      </>\n    )\n  }\n}\n\nfunction NewWindowStoryWrapperWithRef({ Story }: { Story: Story }, ref: ForwardedRef<HTMLDivElement | null>) {\n  // eslint-disable-next-line no-null/no-null\n  const wrapperRef = useRef<HTMLDivElement | null>(null)\n\n  const [isFirstRender, setIsFirstRender] = useState(true)\n\n  useImperativeHandle<HTMLDivElement | null, HTMLDivElement | null>(ref, () => wrapperRef.current)\n\n  const newWindowContextProviderValue: NewWindowContextValue = useMemo(\n    () => ({\n      newWindowContainerRef: wrapperRef.current\n        ? (wrapperRef as MutableRefObject<HTMLDivElement>)\n        : { current: window.document.createElement('div') }\n    }),\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [isFirstRender]\n  )\n\n  useEffect(() => {\n    setIsFirstRender(false)\n  }, [])\n\n  return (\n    <NewWindowStoryBox ref={wrapperRef}>\n      {!isFirstRender && (\n        <NewWindowContext.Provider value={newWindowContextProviderValue}>\n          <GlobalDecoratorWrapper>\n            <NewWindowStory Story={Story} />\n          </GlobalDecoratorWrapper>\n        </NewWindowContext.Provider>\n      )}\n    </NewWindowStoryBox>\n  )\n}\n\nconst NewWindowStoryWrapper = forwardRef(NewWindowStoryWrapperWithRef)\n\nfunction NewWindowStory({ Story }: { Story: Story }) {\n  const { newWindowContainerRef } = useNewWindow()\n\n  return <Story args={{ baseContainer: newWindowContainerRef.current }} />\n}\n\nconst StoryBox = styled.div`\n  height: 100%;\n  padding: 16px;\n  width: 100%;\n`\n\nconst NewWindowButtonBox = styled.div`\n  position: fixed;\n  right: 16px;\n  top: 16px;\n`\nconst NewWindowStoryBox = styled.div`\n  height: 100%;\n  padding: 16px;\n  width: 100%;\n`\n"],"names":[],"sourceRoot":""}